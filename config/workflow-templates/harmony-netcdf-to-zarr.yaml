apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: harmony-netcdf-to-zarr
spec:
  entrypoint: harmony-netcdf-to-zarr
  templates:
    - name: harmony-netcdf-to-zarr
      inputs:
        parameters:
          - name: operation
          - name: image
          - name: image-pull-policy
          - name: AWS_DEFAULT_REGION
          - name: USE_LOCALSTACK
          - name: STAGING_BUCKET
          - name: TEXT_LOGGER
          - name: BACKEND_HOST
      container:
        image: "{{inputs.parameters.image}}"
        imagePullPolicy: "{{inputs.parameters.image-pull-policy}}"
        command: ["python3"]
        args:
          [
            "-m",
            "harmony_netcdf_to_zarr",
            "--harmony-action",
            "invoke",
            "--harmony-input",
            "{{inputs.parameters.operation}}",
          ]
        env:
          - name: AWS_DEFAULT_REGION
            value: "{{inputs.parameters.AWS_DEFAULT_REGION}}"
          - name: USE_LOCALSTACK
            value: "{{inputs.parameters.USE_LOCALSTACK}}"
          - name: EDL_USERNAME
            valueFrom:
              secretKeyRef:
                name: argo-edl-credentials
                key: username
          - name: EDL_PASSWORD
            valueFrom:
              secretKeyRef:
                name: argo-edl-credentials
                key: password
          - name: SHARED_SECRET_KEY
            valueFrom:
              secretKeyRef:
                name: shared-secret
                key: secret-key
          - name: STAGING_BUCKET
            value: "{{inputs.parameters.STAGING_BUCKET}}"
          - name: TEXT_LOGGER
            value: "{{inputs.parameters.TEXT_LOGGER}}"
          - name: BACKEND_HOST
            value: "{{inputs.parameters.BACKEND_HOST}}"
