#!/bin/bash

SELF=$(basename $0)

function usage() {
  echo "Usage: $SELF [-s]"
  echo "  -s: include sds/swot-reproject:latest in deployed serivces. This requires a local build of the sds/swot-reproject:latest image."
}

include_swot_repr=0
while [[ $# -gt 0 ]]
do
key="$1"
echo "$key"
case $key in
  -s)
  include_swot_repr=1
  shift
  ;;
  -h|--help)
  usage && exit 1
  shift
  ;;
  *)
  usage && exit 1
  ;;
esac
done

pids=()
services=(harmony-service-example netcdf-to-zarr concise query-cmr)
if [[ "$include_swot_repr" == "1" ]]; then
echo "including swot_repr"
services+=(swot-reproject)
else
echo "not including swot_repr"
fi
for service in "${services[@]}"; do
echo "stopping $service"
kubectl delete deployment "$service" -n argo
kubectl delete service "$service" -n argo
done

if [[  "$include_swot_repr" == "1" ]]; then
./bin/deploy-services -s
else 
./bin/deploy-services
fi
