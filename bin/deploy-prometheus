#!/bin/bash

env_save=$(export -p)
set -a
source "env-defaults"
source ".env"
set +a
eval "$env_save"

# Deploy prometheus
envsubst < "config/prometheus.yaml" | kubectl apply -f -

# Deploy prometheus adapter
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
helm install -f ./config/prometheus-adapter-helm-values.yaml \
             -n monitoring \
             harmony-prometheus-adapter \
             prometheus-community/prometheus-adapter
