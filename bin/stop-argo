#!/bin/bash

SELF=$(basename $0)

function usage
{
  echo "Usage: $SELF [-c|--context <kubernetes-context>] [-d|--destroy]"
}


DELETE=false

while [[ $# -gt 0 ]]
do
key="$1"

case $key in
  -c|--context)
  KUBE_CONTEXT=$2
  shift
  shift
  ;;
  -d|--destroy)
  DELETE=true
  shift
  ;;
  *)
  usage
  exit 1
  ;;
esac
done

source ".env"

DEFAULT_KUBE_CONTEXT=docker-desktop

KUBE_CONTEXT=${KUBE_CONTEXT:-$DEFAULT_KUBE_CONTEXT}

kubectl config use-context $KUBE_CONTEXT

if [[ "$KUBE_CONTEXT" == "minikube" ]]; then minikube stop; fi

if [ "$DELETE" = true ]
  then
    kubectl delete namespaces argo
    if [[ "$KUBE_CONTEXT" == "minikube" ]]; then minikube delete; fi
fi



