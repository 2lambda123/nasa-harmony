#!/bin/bash

env_save=$(export -p)
set -a
source "env-defaults"
source ".env"
set +a
eval "$env_save"

# Delete kube-state-metrics service
kubectl delete deployment kube-state-metrics -n monitoring
kubectl delete service kube-state-metrics -n monitoring
kubectl delete clusterrolebinding kube-state-metrics
kubectl delete clusterrole kube-state-metrics

# Delete prometheus adapter
PROMETHEUS_NAMESPACE=monitoring
PROMETHEUS_ADAPTER_HELM_NAME=harmony-prometheus-adapter
helm delete ${PROMETHEUS_ADAPTER_HELM_NAME} -n ${PROMETHEUS_NAMESPACE}

# Delete prometheus
envsubst < "config/prometheus.yaml" | kubectl delete -f -

