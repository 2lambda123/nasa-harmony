#!/bin/bash

env_save=$(export -p)
set -a
source "env-defaults"
source ".env"
set +a
eval "$env_save"

# Delete kube-state-metrics service
kubectl delete -f ./config/kube-state-metrics

# Delete prometheus adapter
PROMETHEUS_NAMESPACE=monitoring
PROMETHEUS_ADAPTER_HELM_NAME=harmony-prometheus-adapter
helm delete ${PROMETHEUS_ADAPTER_HELM_NAME} -n ${PROMETHEUS_NAMESPACE}

# Delete prometheus
ALERTS_CONFIG_ENV=$([ "$CLIENT_ID" == "harmony-local" ] && echo "local" || echo "deployed")
envsubst < "config/alert-manager-config-${ALERTS_CONFIG_ENV}.yaml" | kubectl delete -f -
envsubst < "config/prometheus.yaml" | kubectl delete -f -